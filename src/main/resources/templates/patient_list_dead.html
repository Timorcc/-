<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8"/>
	<title>失效病人</title>
	<link rel="stylesheet" href="../static/layui/css/layui.css" th:href="@{/static/layui/css/layui.css}" media="all" />
	<style>
		.layui-table,.layui-table th{ text-align:center; }
	</style>
</head>
<body>
	<blockquote class="layui-elem-quote">
		<div class="layui-inline">
		    <div class="layui-input-inline">
		    	<input type="text"  placeholder="请输入病人姓名" id="searchInp" class="layui-input search_input" th:value="${patName}"/>
		    </div>
		    <a class="layui-btn search_btn search"><i class="layui-icon">&#xe615;</i>查询</a>
		</div>
		<!--<div class="layui-inline">-->
			<!--<button type="button" class="layui-btn layui-btn-normal" id="up"><i class="layui-icon">&#xe67c;</i>文件上传</button>-->
		<!--</div>-->
		<!--<div class="layui-inline">-->
			<!--<a class="layui-btn layui-btn-danger batchDel tanchuang" data-method="mulDel"><i class="layui-icon">&#xe640;</i> 批量删除</a>-->
		<!--</div>-->
	</blockquote>
	<div class="layui-form">
		<table class="layui-table">
			<!--<colgroup>-->
				<!--<col width="5%"/>-->
				<!--<col width="10%"/>-->
				<!--<col width="10%"/>-->
				<!--<col width="10%"/>-->
				<!--<col width="15%"/>-->
                <!--<col width="15%"/>-->
				<!--<col width="15%"/>-->
				<!--<col width="10%"/>-->
				<!--<col width="auto"/>-->
			<!--</colgroup>-->
			<thead>
			<tr>
				<th><input type="checkbox" name="" lay-skin="primary"  lay-filter="allChoose" /></th>
				<th>病人姓名</th>
				<!--<th>分组名称</th>-->
				<th>医生姓名</th>
				<th>身份证号</th>
                <th>就诊卡号</th>
				<th>电话号码</th>
				<th>最近就诊时间</th>
				<th>预计下次就诊时间</th>
				<th>预约就诊时间</th>
				<th>上传体检报告时间</th>
				<th>上传疼痛感时间</th>
				<th>治疗状态</th>
				<th>账号状态</th>
				<th>操作</th>
			</tr>
			</thead>
			<tbody>
			<tr th:each="patView:${patViews}" th:id="${patView.patId}">
				<td><input type="checkbox" name="f"  lay-skin="primary" lay-filter='itemChoose' th:value="${patView.patId}"/></td>
				<td th:text="${patView.patName}"></td>
				<!--<td th:text="${patView.groupName}"></td>-->
				<td th:text="${patView.doctorName}"></td>
				<td th:text="${patView.ideCard}"></td>
				<td th:text="${patView.patCard}"></td>
				<td th:text="${patView.telNumber}"></td>
				<td th:text="${patView.latestVisitDate}"></td>
				<td th:text="${patView.estimatedVisitDate}"></td>
				<td th:text="${patView.certainVisitDate}"></td>
				<td th:text="${patView.uploadDate}"></td>
				<td th:text="${patView.painDate}"></td>
				<td th:text="${patView.state}"></td>
				<td th:text="${patView.comState}"></td>
				<td>
					<a title="置为治疗态" data-method="cure" class="tanchuang"><i class="layui-icon">&#xe6af;</i></a>
				</td>
			</tr>
			</tbody>
		</table>
	</div>
	<div id="page" style="text-align: center"></div>
	<script type="text/javascript" src="../static/layui/layui.js" th:src="@{/static/layui/layui.js}"></script>
	<script type="text/javascript" th:inline="javascript">

		var count = [[${count}]]
        var currPage = [[${currentPage}]]
		var pagesize = [[${pagesize}]]

		//启用所有需要的layui里的组件
        layui.use(['form','jquery','laypage','layer','table'], function(){
            var form = layui.form;
			var $ = layui.jquery;
            var laypage = layui.laypage;
            var layer = layui.layer;

            //分页
            laypage.render({
                elem: 'page', //注意，这里的 page 是 ID，不用加 # 号
                count:count,
                limit:pagesize,
                curr:currPage,
                prev:'上一页',
                next:'下一页',
                layout:['prev', 'page', 'next'],
                jump : function(obj, first) {
                    var patName = $('#searchInp').val();
                    if (!first) {
                        var pindex=obj.curr;
                        /*<![CDATA[*/
                        window.location.href="dead?page="+pindex+'&patName='+patName;//跳转链接
                        /*]]>*/
                    }
                }
            });

            //实现查询
            $('.search').click(function () {
                var patName = $('#searchInp').val();
			   if (patName==null || patName.trim() === ''){
					layer.open({
						title:'提示',
						content:'请输入查询信息'
					});
					return;
				}
                /*<![CDATA[*/
                window.location.href="dead?docName="+patName;
                /*]]>*/
            });

            //全选
            form.on('checkbox(allChoose)', function(data){
                var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
                child.each(function(index, item){
                    item.checked = data.elem.checked;
                });
                form.render('checkbox');
            });

            //取消全选
            form.on('checkbox(itemChoose)',function(data){
                var sib = $(data.elem).parents('table').find('tbody input[type="checkbox"]:checked').length;
                var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;
                if(sib == total){
                    $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",true);
                    form.render();
                }else{
                    $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",false);
                    form.render();
                }
            });

            //设计弹出层
            var active = {
                //设置为痊愈态
                cure: function(othis){
                    var id=  $(othis).parent('td').parent('tr').attr('id');
                    layer.open({
                        type: 1
                        ,title: false //不显示标题栏
                        ,closeBtn: false
                        ,area: '300px;'
                        ,shade: 0.8
                        ,id: 'LAY_layuipro'//设定一个id，防止重复弹出
                        ,btn: ['确定','放弃本次操作']
                        ,btnAlign: 'c'
                        ,moveType: 1 //拖拽模式，0或者1
                        ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;text-align: center">是否设置该病人治疗态?</div>'
                        ,yes: function(index){
                            layer.close(index);
                            $.ajax({
                                type: 'POST',
                                url: 'pat/cure',
                                data: {id:id},
                                dataType: 'json',
                                success: function(data){
                                    if(data.state){
                                        layer.msg('该病人已经设置为治疗态!',{icon:1,time:1000});
                                        /*<![CDATA[*/
                                        window.location.href="dead?page="+currPage;//跳转链接
                                        /*]]>*/
                                    }else {
                                        layer.msg('修改过程出现错误，请稍后重试!',{icon:1,time:1000});
                                    }
                                }
                            });
                        }
                    });
                }
            };

            //启用弹出层
            $('.tanchuang').on('click', function(){
                var othis = $(this), method = othis.data('method');
                active[method] ? active[method].call(this, othis) : '';
            });


        });



	</script>
</body>
</html>